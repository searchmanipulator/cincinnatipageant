scheduler.xy.map_date_width=188;scheduler.xy.map_description_width=400;scheduler.config.map_resolve_event_location=true;scheduler.config.map_resolve_user_location=true;scheduler.config.map_initial_position=new google.maps.LatLng(48.724,8.215);scheduler.config.map_error_position=new google.maps.LatLng(15,15);scheduler.config.map_infowindow_max_width=300;scheduler.config.map_type=google.maps.MapTypeId.ROADMAP;scheduler.config.map_zoom_after_resolve=15;scheduler.locale.labels.marker_geo_success="It seems you are here.";scheduler.locale.labels.marker_geo_fail="Sorry, could not get your current position using geolocation.";scheduler.templates.marker_date=scheduler.date.date_to_str("%Y-%m-%d %H:%i");scheduler.templates.marker_text=function(C,A,B){return"<div><b>"+B.text+"</b><br/><br/>"+(B.event_location||"")+"<br/><br/>"+scheduler.templates.marker_date(C)+" - "+scheduler.templates.marker_date(A)+"</div>"};scheduler.dblclick_dhx_map_area=function(){if(!this.config.readonly&&this.config.dblclick_create){this.addEventNow({start_date:scheduler._date,end_date:scheduler.date.add(scheduler._date,scheduler.config.time_step,"minute")})}};scheduler.templates.map_time=function(C,A,B){if(B._timed){return this.day_date(B.start_date,B.end_date,B)+" "+this.event_date(C)}else{return scheduler.templates.day_date(C)+" &ndash; "+scheduler.templates.day_date(A)}};scheduler.templates.map_text=function(C,A,B){return B.text};scheduler.date.map_start=function(A){return A};scheduler.date.add_map=function(A,B,C){return(new Date(A.valueOf()))};scheduler.templates.map_date=function(A,B,C){return""};scheduler._latLngUpdate=false;scheduler.attachEvent("onSchedulerReady",function(){(function(){scheduler._isMapPositionSet=false;var M=document.createElement("div");M.className="dhx_map";M.id="dhx_gmap";M.style.dispay="none";var L=scheduler._obj;L.appendChild(M);scheduler._els.dhx_gmap=[];scheduler._els.dhx_gmap.push(M);G("dhx_gmap");var K={zoom:scheduler.config.map_inital_zoom||10,center:scheduler.config.map_initial_position,mapTypeId:scheduler.config.map_type||google.maps.MapTypeId.ROADMAP};var N=new google.maps.Map(document.getElementById("dhx_gmap"),K);N.disableDefaultUI=false;N.disableDoubleClickZoom=!scheduler.config.readonly;google.maps.event.addListener(N,"dblclick",function(Q){if(!scheduler.config.readonly&&scheduler.config.dblclick_create){var P=Q.latLng;geocoder.geocode({latLng:P},function(S,R){if(R==google.maps.GeocoderStatus.OK){P=S[0].geometry.location;scheduler.addEventNow({lat:P.lat(),lng:P.lng(),event_location:S[0].formatted_address,start_date:scheduler._date,end_date:scheduler.date.add(scheduler._date,scheduler.config.time_step,"minute")})}})}});var O={content:""};if(scheduler.config.map_infowindow_max_width){O.maxWidth=scheduler.config.map_infowindow_max_width}scheduler.map={_points:[],_markers:[],_infowindow:new google.maps.InfoWindow(O),_infowindows_content:[],_initialization_count:-1,_obj:N};geocoder=new google.maps.Geocoder();if(scheduler.config.map_resolve_user_location){if(navigator.geolocation){if(!scheduler._isMapPositionSet){navigator.geolocation.getCurrentPosition(function(P){var Q=new google.maps.LatLng(P.coords.latitude,P.coords.longitude);N.setCenter(Q);N.setZoom(scheduler.config.map_zoom_after_resolve||10);scheduler.map._infowindow.setContent(scheduler.locale.labels.marker_geo_success);scheduler.map._infowindow.position=N.getCenter();scheduler.map._infowindow.open(N);scheduler._isMapPositionSet=true},function(){scheduler.map._infowindow.setContent(scheduler.locale.labels.marker_geo_fail);scheduler.map._infowindow.setPosition(N.getCenter());scheduler.map._infowindow.open(N);scheduler._isMapPositionSet=true})}}}google.maps.event.addListener(N,"resize",function(P){M.style.zIndex="5";N.setZoom(N.getZoom())});google.maps.event.addListener(N,"tilesloaded",function(P){M.style.zIndex="5"});M.style.display="none"})();scheduler.attachEvent("onSchedulerResize",function(){if(this._mode=="map"){this.map_view(true);return false}return true});var C=scheduler.render_data;scheduler.render_data=function(K,N){if(this._mode=="map"){E();var M=scheduler.get_visible_events();for(var L=0;L<M.length;L++){if(!scheduler.map._markers[M[L].id]){I(M[L],false,false)}}}else{return C.apply(this,arguments)}};function B(L){if(L){var K=scheduler.locale.labels;scheduler._els.dhx_cal_header[0].innerHTML="<div class='dhx_map_line' style='width: "+(scheduler.xy.map_date_width+scheduler.xy.map_description_width+2)+"px;' ><div style='width: "+scheduler.xy.map_date_width+"px;'>"+K.date+"</div><div class='headline_description' style='width: "+scheduler.xy.map_description_width+"px;'>"+K.description+"</div></div>";scheduler._table_view=true;scheduler.set_sizes()}}function J(){scheduler._selected_event_id=null;scheduler.map._infowindow.close();var L=scheduler.map._markers;for(var K in L){if(L.hasOwnProperty(K)){L[K].setMap(null);delete scheduler.map._markers[K];if(scheduler.map._infowindows_content[K]){delete scheduler.map._infowindows_content[K]}}}}function E(){var P=scheduler.get_visible_events();P.sort(function(T,S){if(T.start_date<S.start_date){return -1}if(T.start_date.valueOf()==S.start_date.valueOf()){if(T.text<S.text){return -1}else{if(T.text==S.text){return 0}else{return 1}}}else{return 1}});var O="<div class='dhx_map_area'>";for(var N=0;N<P.length;N++){var Q=P[N];var L=(Q.id==scheduler._selected_event_id)?"dhx_map_line highlight":"dhx_map_line";var R=(Q.color?("background-color:"+Q.color+";"):"");var K=(Q.textColor?("color:"+Q.textColor+";"):"");O+="<div class='"+L+"' event_id='"+Q.id+"' style='"+R+""+K+""+(Q._text_style||"")+" width: "+(scheduler.xy.map_date_width+scheduler.xy.map_description_width+2)+"px;'><div style='width: "+scheduler.xy.map_date_width+"px;' >"+scheduler.templates.map_time(Q.start_date,Q.end_date,Q)+"</div>";O+="<div class='dhx_event_icon icon_details'>&nbsp</div>";O+="<div class='line_description' style='width:"+(scheduler.xy.map_description_width-25)+"px;'>"+scheduler.templates.map_text(Q.start_date,Q.end_date,Q)+"</div></div>"}O+="<div class='dhx_v_border' style='left: "+(scheduler.xy.map_date_width-2)+"px;'></div><div class='dhx_v_border_description'></div></div>";scheduler._els.dhx_cal_data[0].scrollTop=0;scheduler._els.dhx_cal_data[0].innerHTML=O;scheduler._els.dhx_cal_data[0].style.width=(scheduler.xy.map_date_width+scheduler.xy.map_description_width+1)+"px";var M=scheduler._els.dhx_cal_data[0].firstChild.childNodes;scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[scheduler._mode+"_date"](scheduler._min_date,scheduler._max_date,scheduler._mode);scheduler._rendered=[];for(var N=0;N<M.length-2;N++){scheduler._rendered[N]=M[N]}}function G(L){var N=document.getElementById(L);var K=scheduler._y-scheduler.xy.nav_height;if(K<0){K=0}var M=scheduler._x-scheduler.xy.map_date_width-scheduler.xy.map_description_width-1;if(M<0){M=0}N.style.height=K+"px";N.style.width=M+"px";N.style.marginLeft=(scheduler.xy.map_date_width+scheduler.xy.map_description_width+1)+"px";N.style.marginTop=(scheduler.xy.nav_height+2)+"px"}scheduler.map_view=function(O){scheduler.map._initialization_count++;var N=scheduler._els.dhx_gmap[0];scheduler._els.dhx_cal_data[0].style.width=(scheduler.xy.map_date_width+scheduler.xy.map_description_width+1)+"px";scheduler._min_date=scheduler.config.map_start||(new Date());scheduler._max_date=scheduler.config.map_end||(new Date(9999,1,1));scheduler._table_view=true;B(O);if(O){J();E();N.style.display="block";G("dhx_gmap");var M=scheduler.map._obj.getCenter();var L=scheduler.get_visible_events();for(var K=0;K<L.length;K++){if(!scheduler.map._markers[L[K].id]){I(L[K])}}}else{N.style.display="none"}google.maps.event.trigger(scheduler.map._obj,"resize");if(scheduler.map._initialization_count===0&&M){scheduler.map._obj.setCenter(M)}if(scheduler._selected_event_id){D(scheduler._selected_event_id)}};var D=function(K){scheduler.map._obj.setCenter(scheduler.map._points[K]);scheduler.callEvent("onClick",[K])};var I=function(O,L,M){var K=scheduler.config.map_error_position;if(O.lat&&O.lng){K=new google.maps.LatLng(O.lat,O.lng)}var N=scheduler.templates.marker_text(O.start_date,O.end_date,O);if(!scheduler._new_event){scheduler.map._infowindows_content[O.id]=N;if(scheduler.map._markers[O.id]){scheduler.map._markers[O.id].setMap(null)}scheduler.map._markers[O.id]=new google.maps.Marker({position:K,map:scheduler.map._obj});google.maps.event.addListener(scheduler.map._markers[O.id],"click",function(){scheduler.map._infowindow.setContent(scheduler.map._infowindows_content[O.id]);scheduler.map._infowindow.open(scheduler.map._obj,scheduler.map._markers[O.id]);scheduler._selected_event_id=O.id;scheduler.render_data()});scheduler.map._points[O.id]=K;if(L){scheduler.map._obj.setCenter(scheduler.map._points[O.id])}if(M){scheduler.callEvent("onClick",[O.id])}}};scheduler.attachEvent("onClick",function(M,K){if(this._mode=="map"){scheduler._selected_event_id=M;for(var L=0;L<scheduler._rendered.length;L++){scheduler._rendered[L].className="dhx_map_line";if(scheduler._rendered[L].getAttribute("event_id")==M){scheduler._rendered[L].className+=" highlight"}}if(scheduler.map._points[M]&&scheduler.map._markers[M]){scheduler.map._obj.setCenter(scheduler.map._points[M]);google.maps.event.trigger(scheduler.map._markers[M],"click")}}return true});var F=function(K){if(K.event_location&&geocoder){geocoder.geocode({address:K.event_location,language:scheduler.uid().toString()},function(N,M){var L={};if(M!=google.maps.GeocoderStatus.OK){L=scheduler.callEvent("onLocationError",[K.id]);if(!L||L===true){L=scheduler.config.map_error_position}}else{L=N[0].geometry.location}K.lat=L.lat();K.lng=L.lng();scheduler._selected_event_id=K.id;scheduler._latLngUpdate=true;scheduler.callEvent("onEventChanged",[K.id,K]);I(K,true,true)})}else{I(K,true,true)}};var A=function(K){if(K.event_location&&geocoder){geocoder.geocode({address:K.event_location,language:scheduler.uid().toString()},function(N,M){var L={};if(M!=google.maps.GeocoderStatus.OK){L=scheduler.callEvent("onLocationError",[K.id]);if(!L||L===true){L=scheduler.config.map_error_position}}else{L=N[0].geometry.location}K.lat=L.lat();K.lng=L.lng();scheduler._latLngUpdate=true;scheduler.callEvent("onEventChanged",[K.id,K])})}};var H=function(N,L,M,K){setTimeout(function(){var O=N.apply(L,M);N=obj=M=null;return O},K||1)};scheduler.attachEvent("onEventChanged",function(L,M){if(!this._latLngUpdate){var K=scheduler.getEvent(L);if((K.start_date<scheduler._min_date&&K.end_date>scheduler._min_date)||(K.start_date<scheduler._max_date&&K.end_date>scheduler._max_date)||(K.start_date.valueOf()>=scheduler._min_date&&K.end_date.valueOf()<=scheduler._max_date)){if(scheduler.map._markers[L]){scheduler.map._markers[L].setMap(null)}F(K)}else{scheduler._selected_event_id=null;scheduler.map._infowindow.close();if(scheduler.map._markers[L]){scheduler.map._markers[L].setMap(null)}}}else{this._latLngUpdate=false}return true});scheduler.attachEvent("onEventIdChange",function(L,K){var M=scheduler.getEvent(K);if((M.start_date<scheduler._min_date&&M.end_date>scheduler._min_date)||(M.start_date<scheduler._max_date&&M.end_date>scheduler._max_date)||(M.start_date.valueOf()>=scheduler._min_date&&M.end_date.valueOf()<=scheduler._max_date)){if(scheduler.map._markers[L]){scheduler.map._markers[L].setMap(null);delete scheduler.map._markers[L]}if(scheduler.map._infowindows_content[L]){delete scheduler.map._infowindows_content[L]}F(M)}return true});scheduler.attachEvent("onEventAdded",function(K,L){if(!scheduler._dataprocessor){if((L.start_date<scheduler._min_date&&L.end_date>scheduler._min_date)||(L.start_date<scheduler._max_date&&L.end_date>scheduler._max_date)||(L.start_date.valueOf()>=scheduler._min_date&&L.end_date.valueOf()<=scheduler._max_date)){if(scheduler.map._markers[K]){scheduler.map._markers[K].setMap(null)}F(L)}}return true});scheduler.attachEvent("onBeforeEventDelete",function(K,L){if(scheduler.map._markers[K]){scheduler.map._markers[K].setMap(null)}scheduler._selected_event_id=null;scheduler.map._infowindow.close();return true});scheduler._event_resolve_delay=1500;scheduler.attachEvent("onEventLoading",function(K){if(scheduler.config.map_resolve_event_location&&K.event_location&&!K.lat&&!K.lng){scheduler._event_resolve_delay+=1500;H(A,this,[K],scheduler._event_resolve_delay)}return true});scheduler.attachEvent("onEventCancel",function(K,L){if(L){if(scheduler.map._markers[K]){scheduler.map._markers[K].setMap(null)}scheduler.map._infowindow.close()}return true})});