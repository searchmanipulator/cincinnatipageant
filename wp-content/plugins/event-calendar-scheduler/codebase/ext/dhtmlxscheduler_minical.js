scheduler.templates.calendar_month=scheduler.date.date_to_str("%F %Y");scheduler.templates.calendar_scale_date=scheduler.date.date_to_str("%D");scheduler.templates.calendar_date=scheduler.date.date_to_str("%d");scheduler.renderCalendar=function(G,A){var B=null;var D=G.date||(new Date());if(typeof D=="string"){D=this.templates.api_date(D)}if(!A){var M=G.container;var K=G.position;if(typeof M=="string"){M=document.getElementById(M)}if(typeof K=="string"){K=document.getElementById(K)}if(K&&(typeof K.left=="undefined")){var H=getOffset(K);K={top:H.top+K.offsetHeight,left:H.left}}if(!M){M=scheduler._get_def_cont(K)}B=this._render_calendar(M,D,G);B.onclick=function(P){P=P||event;var Q=P.target||P.srcElement;if(Q.className.indexOf("dhx_month_head")!=-1){var O=Q.parentNode.className;if(O.indexOf("dhx_after")==-1&&O.indexOf("dhx_before")==-1){var N=scheduler.templates.xml_date(this.getAttribute("date"));N.setDate(parseInt(Q.innerHTML,10));scheduler.unmarkCalendar(this);scheduler.markCalendar(this,N,"dhx_calendar_click");this._last_date=N;if(this.conf.handler){this.conf.handler.call(scheduler,N,this)}}}}}else{B=this._render_calendar(A.parentNode,D,G,A);scheduler.unmarkCalendar(B)}var C=scheduler.date.month_start(D);var E=scheduler.date.add(C,1,"month");var L=this.getEvents(C,E);for(var F=0;F<L.length;F++){var J=L[F];var I=J.start_date;if(I.valueOf()<C.valueOf()){I=C}I=scheduler.date.date_part(new Date(I.valueOf()));while(I<J.end_date){this.markCalendar(B,I,"dhx_year_event");I=this.date.add(I,1,"day");if(I.valueOf()>=E.valueOf()){break}}}this._markCalendarCurrentDate(B);B.conf=G;return B};scheduler._get_def_cont=function(A){if(!this._def_count){this._def_count=document.createElement("DIV");this._def_count.style.cssText="position:absolute;z-index:10100;width:251px; height:175px;";this._def_count.onclick=function(B){(B||event).cancelBubble=true};document.body.appendChild(this._def_count)}this._def_count.style.left=A.left+"px";this._def_count.style.top=A.top+"px";this._def_count._created=new Date();return this._def_count};scheduler._locateCalendar=function(C,A){var B=C.childNodes[2].childNodes[0];if(typeof A=="string"){A=scheduler.templates.api_date(A)}var D=C.week_start+A.getDate()-1;return B.rows[Math.floor(D/7)].cells[D%7].firstChild};scheduler.markCalendar=function(C,A,B){this._locateCalendar(C,A).className+=" "+B};scheduler.unmarkCalendar=function(D,A,B){A=A||D._last_date;B=B||"dhx_calendar_click";if(!A){return }var C=this._locateCalendar(D,A);C.className=(C.className||"").replace(RegExp(B,"g"))};scheduler._week_template=function(B){var F=(B||250);var E=0;var C=document.createElement("div");var D=this.date.week_start(new Date());for(var A=0;A<7;A++){this._cols[A]=Math.floor(F/(7-A));this._render_x_header(A,E,D,C);D=this.date.add(D,1,"day");F-=this._cols[A];E+=this._cols[A]}C.lastChild.className+=" dhx_scale_bar_last";return C};scheduler.updateCalendar=function(B,A){B.conf.date=A;this.renderCalendar(B.conf,B)};scheduler._mini_cal_arrows=["&nbsp","&nbsp"];scheduler._render_calendar=function(H,A,G,E){var B=scheduler.templates;var M=this._cols;this._cols=[];var U=this._mode;this._mode="calendar";var T=this._colsS;this._colsS={height:0};var S=new Date(this._min_date);var Q=new Date(this._max_date);var P=new Date(scheduler._date);var N=B.month_day;B.month_day=B.calendar_date;A=this.date.month_start(A);var F=this._week_template(H.offsetWidth-1);var O;if(E){O=E}else{O=document.createElement("DIV");O.className="dhx_cal_container dhx_mini_calendar"}O.setAttribute("date",this.templates.xml_format(A));O.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_week'>"+F.innerHTML+"</div><div class='dhx_year_body'></div>";O.childNodes[0].innerHTML=this.templates.calendar_month(A);if(G.navigation){var D=document.createElement("DIV");D.className="dhx_cal_prev_button";D.style.cssText="left:1px;top:2px;position:absolute;";D.innerHTML=this._mini_cal_arrows[0];O.firstChild.appendChild(D);D.onclick=function(){scheduler.updateCalendar(O,scheduler.date.add(O._date,-1,"month"));if(scheduler._date.getMonth()==O._date.getMonth()&&scheduler._date.getFullYear()==O._date.getFullYear()){scheduler._markCalendarCurrentDate(O)}};D=document.createElement("DIV");D.className="dhx_cal_next_button";D.style.cssText="left:auto; right:1px;top:2px;position:absolute;";D.innerHTML=this._mini_cal_arrows[1];O.firstChild.appendChild(D);D.onclick=function(){scheduler.updateCalendar(O,scheduler.date.add(O._date,1,"month"));if(scheduler._date.getMonth()==O._date.getMonth()&&scheduler._date.getFullYear()==O._date.getFullYear()){scheduler._markCalendarCurrentDate(O)}}}O._date=new Date(A);O.week_start=(A.getDay()-(this.config.start_on_monday?1:0)+7)%7;var R=this.date.week_start(A);this._reset_month_scale(O.childNodes[2],A,R);var J=O.childNodes[2].firstChild.rows;for(var K=J.length;K<6;K++){var L=J[J.length-1];J[0].parentNode.appendChild(L.cloneNode(true));var C=parseInt(L.childNodes[L.childNodes.length-1].childNodes[0].innerHTML);C=(C<10)?C:0;for(var I=0;I<J[K].childNodes.length;I++){J[K].childNodes[I].className="dhx_after";J[K].childNodes[I].childNodes[0].innerHTML=scheduler.date.to_fixed(++C)}}if(!E){H.appendChild(O)}O.childNodes[1].style.height=(O.childNodes[1].childNodes[0].offsetHeight-1)+"px";this._cols=M;this._mode=U;this._colsS=T;this._min_date=S;this._max_date=Q;scheduler._date=P;B.month_day=N;return O};scheduler.destroyCalendar=function(B,A){if(!B&&this._def_count&&this._def_count.firstChild){if(A||(new Date()).valueOf()-this._def_count._created.valueOf()>500){B=this._def_count.firstChild}}if(!B){return }B.onclick=null;B.innerHTML="";if(B.parentNode){B.parentNode.removeChild(B)}if(this._def_count){this._def_count.style.top="-1000px"}};scheduler.isCalendarVisible=function(){if(this._def_count&&parseInt(this._def_count.style.top,10)>0){return this._def_count}return false};scheduler.attachEvent("onTemplatesReady",function(){dhtmlxEvent(document.body,"click",function(){scheduler.destroyCalendar()})});scheduler.templates.calendar_time=scheduler.date.date_to_str("%d-%m-%Y");scheduler.form_blocks.calendar_time={render:function(){var D="<input class='dhx_readonly' type='text' readonly='true'>";var B=scheduler.config;var F=this.date.date_part(new Date());var E=24*60,H=0;if(B.limit_time_select){H=60*B.first_hour;E=60*B.last_hour+1}F.setHours(H);D+=" <select>";for(var C=H;C<E;C+=this.config.time_step*1){var G=this.templates.time_picker(F);D+="<option value='"+C+"'>"+G+"</option>";F=this.date.add(F,this.config.time_step,"minute")}D+="</select>";var A=scheduler.config.full_day;return"<div style='height:30px;padding-top:0; font-size:inherit;' class='dhx_section_time'>"+D+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+D+"</div>"},set_value:function(B,L,I){var E=B.getElementsByTagName("input");var G=B.getElementsByTagName("select");var A=function(O,M,N){O.onclick=function(){scheduler.destroyCalendar(null,true);scheduler.renderCalendar({position:O,date:new Date(this._date),navigation:true,handler:function(P){O.value=scheduler.templates.calendar_time(P);O._date=new Date(P);scheduler.destroyCalendar();if(scheduler.config.event_duration&&scheduler.config.auto_end_date&&N==0){K()}}})}};if(scheduler.config.full_day){if(!B._full_day){var D="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";if(!scheduler.config.wide_form){D=B.previousSibling.innerHTML+D}B.previousSibling.innerHTML=D;B._full_day=true}var J=B.previousSibling.getElementsByTagName("input")[0];var F=(scheduler.date.time_part(I.start_date)==0&&scheduler.date.time_part(I.end_date)==0);J.checked=F;for(var C in G){G[C].disabled=J.checked}for(var C=0;C<E.length;C++){E[C].disabled=J.checked}J.onclick=function(){if(J.checked==true){var P={};scheduler.form_blocks.calendar_time.get_value(B,P);var N=scheduler.date.date_part(P.start_date);var R=scheduler.date.date_part(P.end_date);if(N.valueOf()==R.valueOf()){R=scheduler.date.add(N,1,"day")}}var Q=N||I.start_date;var M=R||I.end_date;H(E[0],Q);H(E[1],M);G[0].value=Q.getHours()*60+Q.getMinutes();G[1].value=M.getHours()*60+M.getMinutes();for(var O in G){G[O].disabled=J.checked}for(var O=0;O<E.length;O++){E[O].disabled=J.checked}}}if(scheduler.config.event_duration&&scheduler.config.auto_end_date){function K(){I.start_date=scheduler.date.add(E[0]._date,G[0].value,"minute");I.end_date.setTime(I.start_date.getTime()+(scheduler.config.event_duration*60*1000));E[1].value=scheduler.templates.calendar_time(I.end_date);E[1]._date=scheduler.date.date_part(new Date(I.end_date));G[1].value=I.end_date.getHours()*60+I.end_date.getMinutes()}G[0].onchange=K}function H(O,M,N){A(O,M,N);O.value=scheduler.templates.calendar_time(M);O._date=scheduler.date.date_part(new Date(M))}H(E[0],I.start_date,0);H(E[1],I.end_date,1);A=function(){};G[0].value=I.start_date.getHours()*60+I.start_date.getMinutes();G[1].value=I.end_date.getHours()*60+I.end_date.getMinutes()},get_value:function(D,C){var A=D.getElementsByTagName("input");var B=D.getElementsByTagName("select");C.start_date=scheduler.date.add(A[0]._date,B[0].value,"minute");C.end_date=scheduler.date.add(A[1]._date,B[1].value,"minute");if(C.end_date<=C.start_date){C.end_date=scheduler.date.add(C.start_date,scheduler.config.time_step,"minute")}},focus:function(A){}};scheduler.linkCalendar=function(B,C){var A=function(){var D=scheduler._date;var E=new Date(D.valueOf());if(C){E=C(E)}E.setDate(1);scheduler.updateCalendar(B,E);return true};scheduler.attachEvent("onViewChange",A);scheduler.attachEvent("onXLE",A);scheduler.attachEvent("onEventAdded",A);scheduler.attachEvent("onEventChanged",A);scheduler.attachEvent("onAfterEventDelete",A);A()};scheduler._markCalendarCurrentDate=function(D){var A=scheduler._date;var F=scheduler._mode;if(D._date.getMonth()==A.getMonth()&&D._date.getFullYear()==A.getFullYear()){if(F=="day"||(this._props&&!!this._props[F])){scheduler.markCalendar(D,A,"dhx_calendar_click")}else{if(F=="week"){var E=scheduler.date.week_start(new Date(A.valueOf()));for(var B=0;B<7;B++){var C=E.getMonth()+E.getYear()*12-A.getMonth()-A.getYear()*12;if(!C){scheduler.markCalendar(D,E,"dhx_calendar_click")}E=scheduler.date.add(E,1,"day")}}}}};