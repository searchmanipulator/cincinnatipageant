(function(){scheduler.matrix={};scheduler._merge=function(N,M){for(var O in M){if(typeof N[O]=="undefined"){N[O]=M[O]}}};scheduler.createTimelineView=function(P){scheduler._merge(P,{section_autoheight:true,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:scheduler.xy.bar_height-5,event_min_dy:scheduler.xy.bar_height-5,resize_events:true,fit_events:true,second_scale:false,_logic:function(T,S,R){var Q={};if(scheduler.checkEvent("onBeforeViewRender")){Q=scheduler.callEvent("onBeforeViewRender",[T,S,R])}return Q}});if(scheduler.checkEvent("onTimelineCreated")){scheduler.callEvent("onTimelineCreated",[P])}var M=scheduler.render_data;scheduler.render_data=function(Q,S){if(this._mode==P.name){if(S){for(var R=0;R<Q.length;R++){this.clear_event(Q[R]);this.render_timeline_event.call(this.matrix[this._mode],Q[R],true)}}else{C.call(P,true)}}else{return M.apply(this,arguments)}};scheduler.matrix[P.name]=P;scheduler.templates[P.name+"_cell_value"]=function(Q){return Q?Q.length:""};scheduler.templates[P.name+"_cell_class"]=function(Q){return""};scheduler.templates[P.name+"_scalex_class"]=function(Q){return""};scheduler.templates[P.name+"_second_scalex_class"]=function(Q){return""};scheduler.templates[P.name+"_scaley_class"]=function(R,S,Q){return""};scheduler.templates[P.name+"_scale_label"]=function(R,S,Q){return S};scheduler.templates[P.name+"_tooltip"]=function(R,Q,S){return S.text};scheduler.templates[P.name+"_date"]=function(R,Q){if(R.getDay()==Q.getDay()&&Q-R<(24*60*60*1000)){return scheduler.templates.day_date(R)}return scheduler.templates.week_date(R,Q)};scheduler.templates[P.name+"_scale_date"]=scheduler.date.date_to_str(P.x_date||scheduler.config.hour_date);scheduler.templates[P.name+"_second_scale_date"]=scheduler.date.date_to_str((P.second_scale&&P.second_scale.x_date)?P.second_scale.x_date:scheduler.config.hour_date);scheduler.date["add_"+P.name]=function(R,Q,S){return scheduler.date.add(R,(P.x_length||P.x_size)*Q*P.x_step,P.x_unit)};scheduler.date[P.name+"_start"]=scheduler.date[P.x_unit+"_start"]||scheduler.date.day_start;scheduler.attachEvent("onSchedulerResize",function(){if(this._mode==P.name){C.call(P,true);return false}return true});scheduler.attachEvent("onOptionsLoad",function(){P.order={};scheduler.callEvent("onOptionsLoadStart",[]);for(var Q=0;Q<P.y_unit.length;Q++){P.order[P.y_unit[Q].key]=Q}scheduler.callEvent("onOptionsLoadFinal",[]);if(scheduler._date&&P.name==scheduler._mode){scheduler.setCurrentView(scheduler._date,scheduler._mode)}});scheduler.callEvent("onOptionsLoad",[P]);scheduler[P.name+"_view"]=function(){scheduler.renderMatrix.apply(P,arguments)};if(P.render!="cell"){var O=new Date();var N=(scheduler.date.add(O,P.x_step,P.x_unit).valueOf()-O.valueOf());scheduler["mouse_"+P.name]=function(V){var Q=this._drag_event;if(this._drag_id){Q=this.getEvent(this._drag_id);this._drag_event._dhx_changed=true}V.x-=P.dx;var U=0,T=0,R=0;for(T;T<this._cols.length-1;T++){U+=this._cols[T];if(U>V.x){break}}U=0;for(R;R<this._colsS.heights.length;R++){U+=this._colsS.heights[R];if(U>V.y){break}}V.fields={};if(!P.y_unit[R]){R=P.y_unit.length-1}V.section=V.fields[P.y_property]=Q[P.y_property]=P.y_unit[R].key;V.x=0;if(this._drag_mode=="new-size"&&Q.start_date*1==this._drag_start*1){T++}if(T>=P._trace_x.length){var S=scheduler.date.add(P._trace_x[P._trace_x.length-1],P.x_step,P.x_unit)}else{var S=P._trace_x[T]}V.y=Math.round((S-this._min_date)/(1000*60*this.config.time_step));V.custom=true;V.shift=N;return V}}};scheduler.render_timeline_event=function(Y,V){var S=Y._sorder;var P=G(Y,false,this._step);var M=G(Y,true,this._step);var O=this.event_dy;if(this.event_dy=="full"){if(this.section_autoheight){O=this._section_height-3}else{O=this.dy-3}}if(this.resize_events){O=Math.max(Math.floor(O/Y._count)-1,this.event_min_dy)}var U=O-2;var X=2+S*O+(S?(S*2):0);if(scheduler.config.cascade_event_display){X=2+S*scheduler.config.cascade_event_margin+(S?(S*2):0)}var c=O+X+2;var b=Y[this.y_property];if(!this._events_height[b]||(this._events_height[b]<c)){this._events_height[b]=c}var T=scheduler.templates.event_class(Y.start_date,Y.end_date,Y);T="dhx_cal_event_line "+(T||"");var Z=(Y.color?("background:"+Y.color+";"):"");var Q=(Y.textColor?("color:"+Y.textColor+";"):"");var R='<div event_id="'+Y.id+'" class="'+T+'" style="'+Z+""+Q+"position:absolute; top:"+X+"px; height: "+U+"px; left:"+P+"px; width:"+Math.max(0,M-P)+"px;"+(Y._text_style||"")+'">'+scheduler.templates.event_bar_text(Y.start_date,Y.end_date,Y)+"</div>";if(!V){return R}else{var W=document.createElement("DIV");W.innerHTML=R;var N=this.order[b];var a=scheduler._els.dhx_cal_data[0].firstChild.rows[N].cells[1].firstChild;scheduler._rendered.push(W.firstChild);a.appendChild(W.firstChild)}};function L(){var O=scheduler.get_visible_events();var N=[];for(var P=0;P<this.y_unit.length;P++){N[P]=[]}if(!N[Q]){N[Q]=[]}for(var P=0;P<O.length;P++){var Q=this.order[O[P][this.y_property]];var M=0;while(this._trace_x[M+1]&&O[P].start_date>=this._trace_x[M+1]){M++}while(this._trace_x[M]&&O[P].end_date>this._trace_x[M]){if(!N[Q][M]){N[Q][M]=[]}N[Q][M].push(O[P]);M++}}return N}function G(T,R,M){var U=0;var P=(R)?T.end_date:T.start_date;if(P.valueOf()>scheduler._max_date.valueOf()){P=scheduler._max_date}var V=P-scheduler._min_date_timeline;if(V<0){N=0}else{var S=Math.round(V/(M*scheduler._cols[0]));if(S>scheduler._cols.length){S=scheduler._cols.length}for(var Q=0;Q<S;Q++){U+=scheduler._cols[Q]}var O=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*S,scheduler.matrix[scheduler._mode].x_unit);V=P-O;var N=Math.floor(V/M)}U+=(R)?N-14:N+1;return U}function A(h){var V="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>";var X=[];if(scheduler._load_mode){scheduler._load()}if(this.render=="cell"){X=L.call(this)}else{var g=scheduler.get_visible_events();for(var b=0;b<g.length;b++){var U=this.order[g[b][this.y_property]];if(!X[U]){X[U]=[]}X[U].push(g[b])}}var Z=0;for(var c=0;c<scheduler._cols.length;c++){Z+=scheduler._cols[c]}var S=new Date();S=(scheduler.date.add(S,this.x_step*this.x_size,this.x_unit)-S)/Z;this._step=S;this._summ=Z;var e=scheduler._colsS.heights=[];this._events_height={};for(var c=0;c<this.y_unit.length;c++){var k=this._logic(this.render,this.y_unit[c],this);scheduler._merge(k,{height:this.dy});if(this.section_autoheight){if(this.y_unit.length*k.height<h.offsetHeight){k.height=Math.max(k.height,Math.floor((h.offsetHeight-1)/this.y_unit.length))}this._section_height=k.height}scheduler._merge(k,{tr_className:"",style_height:"height:"+k.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell"+((scheduler.templates[this.name+"_scaley_class"](this.y_unit[c].key,this.y_unit[c].label,this.y_unit[c]))?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[c].key,this.y_unit[c].label,this.y_unit[c]):""),td_content:scheduler.templates[this.name+"_scale_label"](this.y_unit[c].key,this.y_unit[c].label,this.y_unit[c]),summ_width:"width:"+Z+"px;",table_className:""});var W="";if(X[c]&&this.render!="cell"){X[c].sort(function(i,d){return i.start_date>d.start_date?1:-1});var T=[];var M=X[c].length;for(var b=0;b<M;b++){var f=X[c][b];var N=0;while(T[N]&&T[N].end_date>f.start_date){N++}var O=(N===0&&T.length);var R=(b+1==M&&N);if(O||R){var P=T.length;for(var Q=0;Q<P;Q++){T[Q]._count=P+(R?1:0)}}T[N]=f;f._sorder=N;f._count=N+1}for(var b=0;b<M;b++){W+=scheduler.render_timeline_event.call(this,X[c][b],false)}}if(this.fit_events){var Y=this._events_height[this.y_unit[c].key]||0;k.height=(Y>k.height)?Y:k.height;k.style_height="height:"+k.height+"px;"}V+="<tr class='"+k.tr_className+"' style='"+k.style_height+"'><td class='"+k.td_className+"' style='"+k.style_width+" height:"+(k.height-1)+"px;'>"+k.td_content+"</td>";if(this.render=="cell"){for(var b=0;b<scheduler._cols.length;b++){V+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](X[c][b],this._trace_x[b],this.y_unit[c])+"' style='width:"+(scheduler._cols[b]-1)+"px'><div style='width:"+(scheduler._cols[b]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](X[c][b])+"</div></td>"}}else{V+="<td><div style='"+k.summ_width+" "+k.style_height+" position:relative;' class='dhx_matrix_line'>";V+=W;V+="<table class='"+k.table_className+"' cellpadding='0' cellspacing='0' style='"+k.summ_width+" "+k.style_height+"' >";for(var b=0;b<scheduler._cols.length;b++){V+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](X[c],this._trace_x[b],this.y_unit[c])+"' style='width:"+(scheduler._cols[b]-1)+"px'><div style='width:"+(scheduler._cols[b]-1)+"px'></div></td>"}V+="</table>";V+="</div></td>"}V+="</tr>"}V+="</table>";this._matrix=X;h.innerHTML=V;scheduler._rendered=[];var a=document.getElementsByTagName("DIV");for(var c=0;c<a.length;c++){if(a[c].getAttribute("event_id")){scheduler._rendered.push(a[c])}}for(var c=0;c<h.firstChild.rows.length;c++){e.push(h.firstChild.rows[c].offsetHeight)}}function D(g){var n=scheduler.xy.scale_height;var M=this._header_resized||scheduler.xy.scale_height;scheduler._cols=[];scheduler._colsS={height:0};this._trace_x=[];var Z=scheduler._x-this.dx-18;var N=[this.dx];var f=scheduler._els.dhx_cal_header[0];f.style.width=(N[0]+Z)+"px";scheduler._min_date_timeline=scheduler._min_date;var O=scheduler._min_date;for(var c=0;c<this.x_size;c++){this._trace_x[c]=new Date(O);O=scheduler.date.add(O,this.x_step,this.x_unit);scheduler._cols[c]=Math.floor(Z/(this.x_size-c));Z-=scheduler._cols[c];N[c+1]=N[c]+scheduler._cols[c]}g.innerHTML="<div></div>";if(this.second_scale){var W=this.second_scale.x_unit;var j=[this._trace_x[0]];var Y=[];var R=[this.dx,this.dx];var T=0;for(var b=0;b<this._trace_x.length;b++){var p=this._trace_x[b];var q=E(W,p,j[T]);if(q){++T;j[T]=p;R[T+1]=R[T]}var V=T+1;Y[T]=scheduler._cols[b]+(Y[T]||0);R[V]+=scheduler._cols[b]}g.innerHTML="<div></div><div></div>";var X=g.firstChild;X.style.height=(M)+"px";var S=g.lastChild;S.style.position="relative";for(var a=0;a<j.length;a++){var U=j[a];var o=scheduler.templates[this.name+"_second_scalex_class"](U);var Q=document.createElement("DIV");Q.className="dhx_scale_bar dhx_second_scale_bar"+((o)?(" "+o):"");scheduler.set_xy(Q,Y[a]-1,M-3,R[a],0);Q.innerHTML=scheduler.templates[this.name+"_second_scale_date"](U);X.appendChild(Q)}}scheduler.xy.scale_height=M;g=g.lastChild;for(var e=0;e<this._trace_x.length;e++){O=this._trace_x[e];scheduler._render_x_header(e,N[e],O,g);var P=scheduler.templates[this.name+"_scalex_class"](O);if(P){g.lastChild.className+=" "+P}}scheduler.xy.scale_height=n;var d=this._trace_x;g.onclick=function(h){var i=B(h);if(i){scheduler.callEvent("onXScaleClick",[i.x,d[i.x],h||event])}};g.ondblclick=function(h){var i=B(h);if(i){scheduler.callEvent("onXScaleDblClick",[i.x,d[i.x],h||event])}}}function E(O,M,N){switch(O){case"hour":return((M.getHours()!=N.getHours())||E("day",M,N));case"day":return !(M.getDate()==N.getDate()&&M.getMonth()==N.getMonth()&&M.getFullYear()==N.getFullYear());case"week":return !(scheduler.date.getISOWeek(M)==scheduler.date.getISOWeek(N)&&M.getFullYear()==N.getFullYear());case"month":return !(M.getMonth()==N.getMonth()&&M.getFullYear()==N.getFullYear());case"year":return !(M.getFullYear()==N.getFullYear());default:return false}}function C(N){if(N){scheduler.set_sizes();F();var M=scheduler._min_date;D.call(this,scheduler._els.dhx_cal_header[0]);A.call(this,scheduler._els.dhx_cal_data[0]);scheduler._min_date=M;scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date);scheduler._table_view=true}}function I(){if(scheduler._tooltip){scheduler._tooltip.style.display="none";scheduler._tooltip.date=""}}function K(P,S,O){if(P.render!="cell"){return }var N=S.x+"_"+S.y;var U=P._matrix[S.y][S.x];if(!U){return I()}U.sort(function(X,W){return X.start_date>W.start_date?1:-1});if(scheduler._tooltip){if(scheduler._tooltip.date==N){return }scheduler._tooltip.innerHTML=""}else{var V=scheduler._tooltip=document.createElement("DIV");V.className="dhx_tooltip";document.body.appendChild(V);V.onclick=scheduler._click.dhx_cal_data}var R="";for(var Q=0;Q<U.length;Q++){var T=(U[Q].color?("background-color:"+U[Q].color+";"):"");var M=(U[Q].textColor?("color:"+U[Q].textColor+";"):"");R+="<div class='dhx_tooltip_line' event_id='"+U[Q].id+"' style='"+T+""+M+"'>";R+="<div class='dhx_tooltip_date'>"+(U[Q]._timed?scheduler.templates.event_date(U[Q].start_date):"")+"</div>";R+="<div class='dhx_event_icon icon_details'>&nbsp;</div>";R+=scheduler.templates[P.name+"_tooltip"](U[Q].start_date,U[Q].end_date,U[Q])+"</div>"}scheduler._tooltip.style.display="";scheduler._tooltip.style.top="0px";if(document.body.offsetWidth-O.left-scheduler._tooltip.offsetWidth<0){scheduler._tooltip.style.left=O.left-scheduler._tooltip.offsetWidth+"px"}else{scheduler._tooltip.style.left=O.left+S.src.offsetWidth+"px"}scheduler._tooltip.date=N;scheduler._tooltip.innerHTML=R;if(document.body.offsetHeight-O.top-scheduler._tooltip.offsetHeight<0){scheduler._tooltip.style.top=O.top-scheduler._tooltip.offsetHeight+S.src.offsetHeight+"px"}else{scheduler._tooltip.style.top=O.top+"px"}}function F(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(N){var M=scheduler.matrix[scheduler._mode];if(M){var P=scheduler._locate_cell_timeline(N);var N=N||event;var O=N.target||N.srcElement;if(P){return K(M,P,getOffset(P.src))}}I()});F=function(){}}scheduler.renderMatrix=function(N){scheduler._els.dhx_cal_data[0].scrollTop=0;var M=scheduler.date[this.name+"_start"](scheduler._date);scheduler._min_date=scheduler.date.add(M,this.x_start*this.x_step,this.x_unit);scheduler._max_date=scheduler.date.add(scheduler._min_date,this.x_size*this.x_step,this.x_unit);scheduler._table_view=true;if(this.second_scale){if(N&&!this._header_resized){this._header_resized=scheduler.xy.scale_height;scheduler.xy.scale_height*=2;scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header"}if(!N&&this._header_resized){scheduler.xy.scale_height/=2;this._header_resized=false;var O=scheduler._els.dhx_cal_header[0];O.className=O.className.replace(/ dhx_second_cal_header/gi,"")}}C.call(this,N)};function H(N){var O=N.parentNode.childNodes;for(var M=0;M<O.length;M++){if(O[M]==N){return M}}return -1}function B(O){O=O||event;var M=O.target?O.target:O.srcElement;while(M&&M.tagName!="DIV"){M=M.parentNode}if(M&&M.tagName=="DIV"){var N=M.className.split(" ")[0];if(N=="dhx_scale_bar"){return{x:H(M),y:-1,src:M,scale:true}}}}scheduler._locate_cell_timeline=function(P){P=P||event;var M=P.target?P.target:P.srcElement;while(M&&M.tagName!="TD"){M=M.parentNode}if(M&&M.tagName=="TD"){var O=M.className.split(" ")[0];if(O=="dhx_matrix_cell"){if(scheduler._isRender("cell")){return{x:M.cellIndex-1,y:M.parentNode.rowIndex,src:M}}else{var N=M.parentNode;while(N&&N.tagName!="TD"){N=N.parentNode}return{x:M.cellIndex,y:N.parentNode.rowIndex,src:M}}}else{if(O=="dhx_matrix_scell"){return{x:-1,y:M.parentNode.rowIndex,src:M,scale:true}}}}return false};var J=scheduler._click.dhx_cal_data;scheduler._click.dhx_cal_data=function(O){var M=J.apply(this,arguments);var N=scheduler.matrix[scheduler._mode];if(N){var P=scheduler._locate_cell_timeline(O);if(P){if(P.scale){scheduler.callEvent("onYScaleClick",[P.y,N.y_unit[P.y],O||event])}else{scheduler.callEvent("onCellClick",[P.x,P.y,N._trace_x[P.x],(((N._matrix[P.y]||{})[P.x])||[]),O||event])}}}return M};scheduler.dblclick_dhx_matrix_cell=function(N){var M=scheduler.matrix[scheduler._mode];if(M){var O=scheduler._locate_cell_timeline(N);if(O){if(O.scale){scheduler.callEvent("onYScaleDblClick",[O.y,M.y_unit[O.y],N||event])}else{scheduler.callEvent("onCellDblClick",[O.x,O.y,M._trace_x[O.x],(((M._matrix[O.y]||{})[O.x])||[]),N||event])}}}};scheduler.dblclick_dhx_matrix_scell=function(M){return scheduler.dblclick_dhx_matrix_cell(M)};scheduler._isRender=function(M){return(scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==M)};scheduler.attachEvent("onCellDblClick",function(N,S,O,M,Q){if(this.config.readonly||(Q.type=="dblclick"&&!this.config.dblclick_create)){return }var R=scheduler.matrix[scheduler._mode];var P={};P.start_date=R._trace_x[N];P.end_date=(R._trace_x[N+1])?R._trace_x[N+1]:scheduler.date.add(R._trace_x[N],R.x_step,R.x_unit);P[scheduler.matrix[scheduler._mode].y_property]=R.y_unit[S].key;scheduler.addEventNow(P,null,Q)});scheduler.attachEvent("onBeforeDrag",function(N,O,M){if(scheduler._isRender("cell")){return false}return true})})();