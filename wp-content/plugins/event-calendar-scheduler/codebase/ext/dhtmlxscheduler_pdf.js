scheduler.toPDF=function(C,J,Q,L){var I=0;var H=0;var F=false;if(J=="fullcolor"){F=true;J="color"}J=J||"color";html_regexp=new RegExp("<[^>]*>","g");newline_regexp=new RegExp("<br[^>]*>","g");function N(U){return U.replace(newline_regexp,"\n").replace(html_regexp,"")}function M(U){U=parseFloat(U);if(isNaN(U)){return"auto"}return 100*U/(I+1)}function R(U){U=parseFloat(U);if(isNaN(U)){return"auto"}return 100*U/H}function P(V){var U="";if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){V=V[0].childNodes}for(var W=0;W<V.length;W++){U+="\n<column><![CDATA["+N(V[W].innerHTML)+"]]></column>"}I=V[0].offsetWidth;return U}function G(W,X){var U=parseInt(W.style.left,10);for(var V=0;V<scheduler._cols.length;V++){U-=scheduler._cols[V];if(U<0){return V}}return X}function O(V,X){var W=parseInt(V.style.top,10);for(var U=0;U<scheduler._colsS.heights.length;U++){if(scheduler._colsS.heights[U]>W){return U}}return X}function A(X){var V="";var Y=X.firstChild.rows;for(var W=0;W<Y.length;W++){var Z=[];for(var U=0;U<Y[W].cells.length;U++){Z.push(Y[W].cells[U].firstChild.innerHTML)}V+="\n<row height='"+X.firstChild.rows[W].cells[0].offsetHeight+"'><![CDATA["+N(Z.join("|"))+"]]></row>";H=X.firstChild.rows[0].cells[0].offsetHeight}return V}function T(Z){var V="<data profile='"+Z+"'";if(Q){V+=" header='"+Q+"'"}if(L){V+=" footer='"+L+"'"}V+=">";var a=scheduler._mode;if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){a="timeline"}V+="<scale mode='"+a+"' today='"+scheduler._els.dhx_cal_date[0].innerHTML+"'>";if(scheduler._mode=="week_agenda"){var U=scheduler._els.dhx_cal_data[0].getElementsByTagName("DIV");for(var W=0;W<U.length;W++){if(U[W].className=="dhx_wa_scale_bar"){V+="<column>"+N(U[W].innerHTML)+"</column>"}}}else{if(scheduler._mode=="agenda"||scheduler._mode=="map"){var U=scheduler._els.dhx_cal_header[0].childNodes[0].childNodes;V+="<column>"+N(U[0].innerHTML)+"</column><column>"+N(U[1].innerHTML)+"</column>"}else{if(scheduler._mode=="year"){var U=scheduler._els.dhx_cal_data[0].childNodes;for(var W=0;W<U.length;W++){V+="<month label='"+N(U[W].childNodes[0].innerHTML)+"'>";V+=P(U[W].childNodes[1].childNodes);V+=A(U[W].childNodes[2]);V+="</month>"}}else{V+="<x>";var U=scheduler._els.dhx_cal_header[0].childNodes;V+=P(U);V+="</x>";var Y=scheduler._els.dhx_cal_data[0];if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){V+="<y>";for(var W=0;W<Y.firstChild.rows.length;W++){var X=Y.firstChild.rows[W];if(X.className!=="dhx_row_folder"){V+="<row><![CDATA["+N(X.cells[0].innerHTML)+"]]></row>"}}V+="</y>";H=Y.firstChild.rows[0].cells[0].offsetHeight}else{if(Y.firstChild.tagName=="TABLE"){V+=A(Y)}else{Y=Y.childNodes[Y.childNodes.length-1];while(Y.className.indexOf("dhx_scale_holder")==-1){Y=Y.previousSibling}Y=Y.childNodes;V+="<y>";for(var W=0;W<Y.length;W++){V+="\n<row><![CDATA["+N(Y[W].innerHTML)+"]]></row>"}V+="</y>";H=Y[0].offsetHeight}}}}}V+="</scale>";return V}function E(V,U){return(window.getComputedStyle?(window.getComputedStyle(V,null)[U]):(V.currentStyle?V.currentStyle[U]:null))||""}function B(){var W="";var c=scheduler._rendered;if(scheduler._mode=="agenda"||scheduler._mode=="map"){for(var n=0;n<c.length;n++){W+="<event><head>"+N(c[n].childNodes[0].innerHTML)+"</head><body>"+N(c[n].childNodes[2].innerHTML)+"</body></event>"}}else{if(scheduler._mode=="week_agenda"){for(var n=0;n<c.length;n++){W+="<event day='"+c[n].parentNode.getAttribute("day")+"'><body>"+N(c[n].innerHTML)+"</body></event>"}}else{if(scheduler._mode=="year"){var c=scheduler.get_visible_events();for(var n=0;n<c.length;n++){var p=c[n].start_date;if(p.valueOf()<scheduler._min_date.valueOf()){p=scheduler._min_date}while(p<c[n].end_date){var f=p.getMonth()+12*(p.getFullYear()-scheduler._min_date.getFullYear())-scheduler.week_starts._month;var l=scheduler.week_starts[f]+p.getDate()-1;var Y=F?E(scheduler._get_year_cell(p),"color"):"";var e=F?E(scheduler._get_year_cell(p),"backgroundColor"):"";W+="<event day='"+(l%7)+"' week='"+Math.floor(l/7)+"' month='"+f+"' backgroundColor='"+e+"' color='"+Y+"'></event>";p=scheduler.date.add(p,1,"day");if(p.valueOf()>=scheduler._max_date.valueOf()){break}}}}else{var k=scheduler.matrix&&scheduler.matrix[scheduler._mode];if(k&&k.render=="cell"){var c=scheduler._els.dhx_cal_data[0].getElementsByTagName("TD");for(var n=0;n<c.length;n++){var Y=F?E(c[n],"color"):"";var e=F?E(c[n],"backgroundColor"):"";W+="\n<event><body backgroundColor='"+e+"' color='"+Y+"'><![CDATA["+N(c[n].innerHTML)+"]]></body></event>"}}else{for(var n=0;n<c.length;n++){var t=M(c[n].style.left);var s=M(c[n].style.width);if(isNaN(s*1)){continue}var r=R(c[n].style.top);var q=R(c[n].style.height);var V=c[n].className.split(" ")[0].replace("dhx_cal_","");if(V==="dhx_tooltip_line"){continue}var o=scheduler.getEvent(c[n].getAttribute("event_id"));var l=o._sday;var g=o._sweek;var X=o._length||0;if(scheduler._mode!="month"){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){l=0;var U=c[n].parentNode.parentNode.parentNode;var a=g=U.rowIndex;var b=U.parentNode;for(var h=0;h<a&&h<b.childNodes.length;h++){if(b.childNodes[h].className==="dhx_row_folder"){g--}}s+=M(10)}else{if(scheduler.xy.menu_width){s+=M(s*20/100);t-=M(15-t*20/100)}if(c[n].parentNode==scheduler._els.dhx_cal_data[0]){continue}t+=M(c[n].parentNode.style.left);t-=M(51)}if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var Z=H;H=180;r=R(c[n].style.top);H=Z}}else{q=parseInt(c[n].offsetHeight,10);r=parseInt(c[n].style.top,10)-22;l=G(c[n],l);g=O(c[n],g)}W+="\n<event week='"+g+"' day='"+l+"' type='"+V+"' x='"+t+"' y='"+r+"' width='"+s+"' height='"+q+"' len='"+X+"'>";if(V=="event"){W+="<header><![CDATA["+N(c[n].childNodes[1].innerHTML)+"]]></header>";var Y=F?E(c[n].childNodes[2],"color"):"";var e=F?E(c[n].childNodes[2],"backgroundColor"):"";W+="<body backgroundColor='"+e+"' color='"+Y+"'><![CDATA["+N(c[n].childNodes[2].innerHTML)+"]]></body>"}else{var Y=F?E(c[n],"color"):"";var e=F?E(c[n],"backgroundColor"):"";W+="<body backgroundColor='"+e+"' color='"+Y+"'><![CDATA["+N(c[n].innerHTML)+"]]></body>"}W+="</event>"}}}}}return W}function K(){var U="</data>";return U}var D=(new Date()).valueOf();var S=document.createElement("div");S.style.display="none";document.body.appendChild(S);S.innerHTML='<form id="'+D+'" method="post" target="_blank" action="'+C+'" accept-charset="utf-8" enctype="application/x-www-form-urlencoded"><input type="hidden" name="mycoolxmlbody"/> </form>';document.getElementById(D).firstChild.value=T(J).replace("\u2013","-")+B()+K();document.getElementById(D).submit();S.parentNode.removeChild(S);grid=null};