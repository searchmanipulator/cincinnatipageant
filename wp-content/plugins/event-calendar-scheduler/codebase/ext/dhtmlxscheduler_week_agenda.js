scheduler._wa={};scheduler.xy.week_agenda_scale_height=20;scheduler.templates.week_agenda_event_text=function(A,D,C,B){return scheduler.templates.event_date(A)+" "+C.text};scheduler.date.week_agenda_start=scheduler.date.week_start;scheduler.date.week_agenda_end=function(A){return scheduler.date.add(A,7,"day")};scheduler.date.add_week_agenda=function(A,B){return scheduler.date.add(A,B*7,"day")};scheduler.attachEvent("onSchedulerReady",function(){var A=scheduler.templates;if(!A.week_agenda_date){A.week_agenda_date=A.week_date}});(function(){var A=scheduler.date.date_to_str("%l, %F %d");scheduler.templates.week_agenda_scale_date=function(B){return A(B)}})();scheduler.attachEvent("onTemplatesReady",function(){scheduler.attachEvent("onSchedulerResize",function(){if(this._mode=="week_agenda"){this.week_agenda_view(true);return false}return true});var B=scheduler.render_data;scheduler.render_data=function(D){if(this._mode=="week_agenda"){A()}else{return B.apply(this,arguments)}};var C=function(){scheduler._cols=[];var D=parseInt(scheduler._els.dhx_cal_data[0].style.width);scheduler._cols.push(Math.floor(D/2));scheduler._cols.push(D-scheduler._cols[0]-1);scheduler._colsS={0:[],1:[]};var F=parseInt(scheduler._els.dhx_cal_data[0].style.height);for(var E=0;E<3;E++){scheduler._colsS[0].push(Math.floor(F/(3-scheduler._colsS[0].length)));F-=scheduler._colsS[0][E]}scheduler._colsS[1].push(scheduler._colsS[0][0]);scheduler._colsS[1].push(scheduler._colsS[0][1]);F=scheduler._colsS[0][scheduler._colsS[0].length-1];scheduler._colsS[1].push(Math.floor(F/2));scheduler._colsS[1].push(F-scheduler._colsS[1][scheduler._colsS[1].length-1])};var A=function(){scheduler._els.dhx_cal_data[0].innerHTML="";scheduler._rendered=[];var J="";for(var T=0;T<2;T++){var P=scheduler._cols[T];var O="dhx_wa_column";if(T==1){O+=" dhx_wa_column_last"}J+="<div class='"+O+"' style='width: "+P+"px;'>";for(var Q=0;Q<scheduler._colsS[T].length;Q++){var H=scheduler.xy.week_agenda_scale_height-2;var M=scheduler._colsS[T][Q]-H-2;var S=Math.min(6,Q*2+T);J+="<div class='dhx_wa_day_cont'><div style='height:"+H+"px; line-height:"+H+"px;' class='dhx_wa_scale_bar'></div><div style='height:"+M+"px;' class='dhx_wa_day_data' day='"+S+"'></div></div>"}J+="</div>"}scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[scheduler._mode+"_date"](scheduler._min_date,scheduler._max_date,scheduler._mode);scheduler._els.dhx_cal_data[0].innerHTML=J;var E=scheduler._els.dhx_cal_data[0].getElementsByTagName("div");var I=[];for(var T=0;T<E.length;T++){if(E[T].className=="dhx_wa_day_cont"){I.push(E[T])}}scheduler._wa._selected_divs=[];var F=scheduler.get_visible_events();var L=scheduler.date.week_start(scheduler._date);var K=scheduler.date.add(L,1,"day");for(var T=0;T<7;T++){I[T]._date=L;var Y=I[T].childNodes[0];var G=I[T].childNodes[1];Y.innerHTML=scheduler.templates.week_agenda_scale_date(L);var N=[];for(var R=0;R<F.length;R++){var D=F[R];if(D.start_date<K&&D.end_date>L){N.push(D)}}N.sort(function(c,Z){if(c.start_date.valueOf()==Z.start_date.valueOf()){return c.id>Z.id?1:-1}return c.start_date>Z.start_date?1:-1});for(var Q=0;Q<N.length;Q++){var V=N[Q];var U=document.createElement("div");scheduler._rendered.push(U);var W=scheduler.templates.event_class(V.start_date,V.end_date,V);U.className="dhx_wa_ev_body"+(W?(" "+W):"");if(V._text_style){U.style.cssText=V._text_style}if(V.color){U.style.backgroundColor=V.color}if(V.textColor){U.style.color=V.textColor}if(scheduler._select_id&&V.id==scheduler._select_id&&!(!scheduler.config.week_agenda_select&&scheduler.config.week_agenda_select!==undefined)){U.className+=" dhx_cal_event_selected";scheduler._wa._selected_divs.push(U)}var X="";if(!V._timed){X="middle";if(V.start_date.valueOf()>=L.valueOf()&&V.start_date.valueOf()<=K.valueOf()){X="start"}if(V.end_date.valueOf()>=L.valueOf()&&V.end_date.valueOf()<=K.valueOf()){X="end"}}U.innerHTML=scheduler.templates.week_agenda_event_text(V.start_date,V.end_date,V,L,X);U.setAttribute("event_id",V.id);G.appendChild(U)}L=scheduler.date.add(L,1,"day");K=scheduler.date.add(K,1,"day")}};scheduler.week_agenda_view=function(D){scheduler._min_date=scheduler.date.week_start(scheduler._date);scheduler._max_date=scheduler.date.add(scheduler._min_date,1,"week");scheduler.set_sizes();if(D){scheduler._table_view=scheduler._allow_dnd=true;scheduler._wa._prev_data_border=scheduler._els.dhx_cal_data[0].style.borderTop;scheduler._els.dhx_cal_data[0].style.borderTop=0;scheduler._els.dhx_cal_data[0].style.overflowY="hidden";scheduler._els.dhx_cal_date[0].innerHTML="";scheduler._els.dhx_cal_data[0].style.top=(parseInt(scheduler._els.dhx_cal_data[0].style.top)-scheduler.xy.bar_height-1)+"px";scheduler._els.dhx_cal_data[0].style.height=(parseInt(scheduler._els.dhx_cal_data[0].style.height)+scheduler.xy.bar_height+1)+"px";scheduler._els.dhx_cal_header[0].style.display="none";C();A()}else{scheduler._table_view=scheduler._allow_dnd=false;if(scheduler._wa._prev_data_border){scheduler._els.dhx_cal_data[0].style.borderTop=scheduler._wa._prev_data_border}scheduler._els.dhx_cal_data[0].style.overflowY="auto";scheduler._els.dhx_cal_data[0].style.top=(parseInt(scheduler._els.dhx_cal_data[0].style.top)+scheduler.xy.bar_height)+"px";scheduler._els.dhx_cal_data[0].style.height=(parseInt(scheduler._els.dhx_cal_data[0].style.height)-scheduler.xy.bar_height)+"px";scheduler._els.dhx_cal_header[0].style.display="block"}};scheduler.mouse_week_agenda=function(J){var L=J.ev;var D=L.srcElement||L.target;while(D.parentNode){if(D._date){var F=D._date}D=D.parentNode}if(!F){return J}J.x=0;var K=F.valueOf()-scheduler._min_date.valueOf();J.y=Math.ceil((K/(1000*60))/this.config.time_step);if(this._drag_mode=="move"){this._drag_event._dhx_changed=true;this._select_id=this._drag_id;for(var H=0;H<scheduler._rendered.length;H++){if(scheduler._drag_id==this._rendered[H].getAttribute("event_id")){var G=this._rendered[H]}}if(!scheduler._wa._dnd){var E=G.cloneNode(true);this._wa._dnd=E;E.className=G.className;E.id="dhx_wa_dnd";E.className+=" dhx_wa_dnd";document.body.appendChild(E)}var I=document.getElementById("dhx_wa_dnd");I.style.top=((L.pageY||L.clientY)+20)+"px";I.style.left=((L.pageX||L.clientX)+20)+"px"}return J};scheduler.attachEvent("onBeforeEventChanged",function(G,E,F){if(this._mode=="week_agenda"){if(this._drag_mode=="move"){var D=document.getElementById("dhx_wa_dnd");D.parentNode.removeChild(D);scheduler._wa._dnd=false}}return true});scheduler.attachEvent("onEventSave",function(F,E,D){if(D&&this._mode=="week_agenda"){this._select_id=F}return true});scheduler._wa._selected_divs=[];scheduler.attachEvent("onClick",function(F,D){if(this._mode=="week_agenda"&&!(!scheduler.config.week_agenda_select&&scheduler.config.week_agenda_select!==undefined)){if(scheduler._wa._selected_divs){for(var E=0;E<this._wa._selected_divs.length;E++){var G=this._wa._selected_divs[E];G.className=G.className.replace(/ dhx_cal_event_selected/,"")}}this.for_rendered(F,function(H){H.className+=" dhx_cal_event_selected";scheduler._wa._selected_divs.push(H)});this._select_id=F;return false}return true})});